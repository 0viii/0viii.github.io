<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Sistema de Tickets</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f4f6f9; }
    h1, h2 { color: #333; }
    form, .ticket { 
      background: #fff; 
      border: 1px solid #ddd; 
      padding: 15px; 
      margin-bottom: 20px; 
      border-radius: 8px; 
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    input, textarea, select, button { 
      width: 100%; 
      margin: 8px 0; 
      padding: 10px; 
      border: 1px solid #ccc; 
      border-radius: 5px; 
      font-size: 14px;
    }
    button { background: #007bff; color: white; border: none; cursor: pointer; }
    button:hover { background: #0056b3; }
    .ticket { background: #fafafa; }
    .estado { font-weight: bold; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>ðŸ“© Sistema de Tickets</h1>

  <!-- Formulario -->
  <form id="ticketForm">
    <input type="text" id="nombre" placeholder="Tu nombre" required>
    <input type="email" id="correo" placeholder="Tu correo" required>
    <input type="text" id="asunto" placeholder="Asunto" required>
    <textarea id="descripcion" placeholder="Describe tu problema" required></textarea>
    <button type="submit">Enviar Ticket</button>
  </form>

  <h2>ðŸŽ« Tickets</h2>
  <div id="listaTickets"></div>

  <!-- Firebase + LÃ³gica -->
  <script type="module">
    // Importa Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, updateDoc, doc } 
      from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // ConfiguraciÃ³n de tu Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDR6PNPfJDmQYv9uXUgedmozkngdk3bKDQ",
      authDomain: "minidavid-134d1.firebaseapp.com",
      projectId: "minidavid-134d1",
      storageBucket: "minidavid-134d1.firebasestorage.app",
      messagingSenderId: "326973939527",
      appId: "1:326973939527:web:32a464ab6f63262cc6b662"
    };

    // Inicializa Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const ticketForm = document.getElementById("ticketForm");
    const listaTickets = document.getElementById("listaTickets");

    // Crear ticket
    ticketForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const nombre = document.getElementById("nombre").value;
      const correo = document.getElementById("correo").value;
      const asunto = document.getElementById("asunto").value;
      const descripcion = document.getElementById("descripcion").value;

      await addDoc(collection(db, "tickets"), {
        nombre, correo, asunto, descripcion,
        estado: "Abierto",
        fecha: new Date()
      });

      alert("âœ… Ticket creado!");
      ticketForm.reset();
      cargarTickets();
    });

    // Cargar tickets
    async function cargarTickets() {
      listaTickets.innerHTML = "";
      const querySnapshot = await getDocs(collection(db, "tickets"));
      querySnapshot.forEach((docSnap) => {
        const data = docSnap.data();
        const div = document.createElement("div");
        div.className = "ticket";
        div.innerHTML = `
          <p><b>Asunto:</b> ${data.asunto}</p>
          <p><b>DescripciÃ³n:</b> ${data.descripcion}</p>
          <p><b>Usuario:</b> ${data.nombre} (${data.correo})</p>
          <p class="estado">Estado: ${data.estado}</p>
          <select onchange="actualizarEstado('${docSnap.id}', this.value)">
            <option value="Abierto" ${data.estado==="Abierto"?"selected":""}>Abierto</option>
            <option value="En Proceso" ${data.estado==="En Proceso"?"selected":""}>En Proceso</option>
            <option value="Cerrado" ${data.estado==="Cerrado"?"selected":""}>Cerrado</option>
          </select>
        `;
        listaTickets.appendChild(div);
      });
    }

    // Cambiar estado
    window.actualizarEstado = async (id, nuevoEstado) => {
      const ticketRef = doc(db, "tickets", id);
      await updateDoc(ticketRef, { estado: nuevoEstado });
      cargarTickets();
    };

    // Inicial
    cargarTickets();
  </script>
</body>
</html>
