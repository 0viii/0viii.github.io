<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Agenda de Citas</title>
<style>
body { font-family: Arial; max-width: 600px; margin: 20px auto; text-align: center; }
h1,h2 { color: #333; }
form { margin-bottom: 20px; }
input, button { padding: 8px; margin: 5px; font-size: 16px; }
button { background: #007bff; color: white; border: none; cursor: pointer; }
button:hover { background: #0056b3; }
ul { list-style-type: none; padding: 0; }
li { padding: 6px 0; border-bottom: 1px solid #ccc; }
#adminSection { display: none; }
</style>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

// Configuración de Firebase
const firebaseConfig = {
  apiKey: "AIzaSyDR6PNPfJDmQYv9uXUgedmozkngdk3bKDQ",
  authDomain: "minidavid-134d1.firebaseapp.com",
  projectId: "minidavid-134d1",
  storageBucket: "minidavid-134d1.firebasestorage.app",
  messagingSenderId: "326973939527",
  appId: "1:326973939527:web:32a464ab6f63262cc6b662"
};

// Inicializar Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window.addEventListener('DOMContentLoaded', () => {
  const citaForm = document.getElementById("citaForm");
  const listaCitas = document.getElementById("listaCitas");
  const adminSection = document.getElementById("adminSection");
  const adminPassForm = document.getElementById("adminPassForm");

  // Guardar cita
  citaForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    const nombre = document.getElementById("nombre").value;
    const fecha = document.getElementById("fecha").value;
    const hora = document.getElementById("hora").value;

    try {
      await addDoc(collection(db, "citas"), { nombre, fecha, hora, timestamp: new Date() });
      citaForm.reset();
      alert("Cita agendada correctamente!");
    } catch (error) {
      console.error("Error al guardar la cita:", error);
      alert("Error al guardar la cita. Intenta de nuevo.");
    }
  });

  // Mostrar citas en tiempo real (solo admin)
  const mostrarCitasAdmin = () => {
    onSnapshot(collection(db, "citas"), (snapshot) => {
      listaCitas.innerHTML = "";
      snapshot.forEach((doc) => {
        const data = doc.data();
        const li = document.createElement("li");
        li.textContent = `${data.nombre} - ${data.fecha} a las ${data.hora}`;
        listaCitas.appendChild(li);
      });
    });
  };

  // Login admin simple
  adminPassForm.addEventListener("submit", (e) => {
    e.preventDefault();
    const password = document.getElementById("adminPassword").value;
    if(password === "admin123"){  // <- Cambia la contraseña aquí
      adminSection.style.display = "block";
      document.getElementById("userSection").style.display = "none";
      mostrarCitasAdmin();
    } else {
      alert("Contraseña incorrecta");
    }
  });
});
</script>
</head>
<body>

<h1>Agenda de Citas</h1>

<!-- Sección usuario -->
<div id="userSection">
  <form id="citaForm">
    <input type="text" id="nombre" placeholder="Tu nombre" required>
    <input type="date" id="fecha" required>
    <input type="time" id="hora" required>
    <button type="submit">Agendar</button>
  </form>

  <h2>Administrador</h2>
  <form id="adminPassForm">
    <input type="password" id="adminPassword" placeholder="Contraseña admin" required>
    <button type="submit">Ingresar</button>
  </form>
</div>

<!-- Sección admin -->
<div id="adminSection">
  <h2>Citas agendadas</h2>
  <ul id="listaCitas"></ul>
</div>

</body>
</html>
