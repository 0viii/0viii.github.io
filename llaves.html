<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Pixel Game Móvil</title>
<style>
body{margin:0;background:#111;overflow:hidden;font-family:sans-serif;}
canvas{display:block;margin:0 auto;background:#222;border:3px solid #fff;}
#controls{position:absolute;bottom:20px;width:100%;display:flex;justify-content:space-around;}
.ctrlBtn{width:70px;height:70px;border-radius:50%;background:rgba(255,255,255,0.2);font-size:30px;text-align:center;line-height:70px;user-select:none;}
</style>
</head>
<body>

<canvas id="game" width="800" height="400"></canvas>

<div id="controls">
  <div class="ctrlBtn" id="leftBtn">←</div>
  <div class="ctrlBtn" id="upBtn">↑</div>
  <div class="ctrlBtn" id="rightBtn">→</div>
</div>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

const groundHeight = 370;

// --- Jugador ---
const player = {x:50, y:300, w:30, h:30, dx:0, dy:0, speed:4, jumpPower:-10, gravity:0.5, grounded:false};

// --- Enemigos ---
const enemies = [{x:300, y:340, w:30, h:30, speed:2, dir:1}];

// --- Power-ups ---
const powerUps = [{x:200, y:340, w:20, h:20, type:"jumpBoost"}];

// --- Meta ---
const goal = {x:750, y:300, w:40, h:70, color:"lime"};

// --- Controles ---
const keys = {left:false, right:false, up:false};

document.addEventListener("keydown", e => {
  if(e.key === "ArrowLeft") keys.left = true;
  if(e.key === "ArrowRight") keys.right = true;
  if(e.key === "ArrowUp") keys.up = true;
});
document.addEventListener("keyup", e => {
  if(e.key === "ArrowLeft") keys.left = false;
  if(e.key === "ArrowRight") keys.right = false;
  if(e.key === "ArrowUp") keys.up = false;
});

// Botones táctiles
["leftBtn","rightBtn","upBtn"].forEach(id=>{
  const key = id.replace("Btn","");
  const el = document.getElementById(id);
  el.addEventListener("touchstart", e => { e.preventDefault(); keys[key]=true; });
  el.addEventListener("touchend", e => { e.preventDefault(); keys[key]=false; });
});

// --- Funciones ---
function rectCollision(r1,r2){
  return r1.x<r2.x+r2.w && r1.x+r1.w>r2.x && r1.y<r2.y+r2.h && r1.y+r1.h>r2.y;
}

function resetPlayer(){
  player.x = 50;
  player.y = 300;
  player.dx = 0;
  player.dy = 0;
  player.grounded = false;
}

// --- Update ---
function update(){
  // Movimiento
  player.dx = 0;
  if(keys.left) player.dx = -player.speed;
  if(keys.right) player.dx = player.speed;
  if(keys.up && player.grounded){ player.dy = player.jumpPower; player.grounded=false; }

  player.dy += player.gravity;
  player.x += player.dx;
  player.y += player.dy;

  // Suelo
  if(player.y + player.h > groundHeight){ player.y = groundHeight - player.h; player.dy=0; player.grounded=true; }

  // Limites de pantalla
  if(player.x < 0) player.x = 0;
  if(player.x + player.w > canvas.width) player.x = canvas.width - player.w;

  // Enemigos
  enemies.forEach(e => {
    e.x += e.speed * e.dir;
    if(e.x<0 || e.x+e.w>canvas.width) e.dir *= -1;
    if(rectCollision(player, e)) resetPlayer();
  });

  // Power-ups
  for(let i = powerUps.length - 1; i >=0; i--){
    const p = powerUps[i];
    if(rectCollision(player,p)){
      if(p.type==="jumpBoost") player.jumpPower=-15;
      powerUps.splice(i,1);
    }
  }

  // Meta
  if(rectCollision(player, goal)){
    alert("¡Nivel completado!");
    resetPlayer();
  }
}

// --- Draw ---
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Fondo
  ctx.fillStyle="#555"; ctx.fillRect(0,groundHeight,canvas.width,canvas.height-groundHeight);

  // Jugador
  ctx.fillStyle="white"; ctx.fillRect(player.x,player.y,player.w,player.h);

  // Enemigos
  ctx.fillStyle="red"; enemies.forEach(e=>ctx.fillRect(e.x,e.y,e.w,e.h));

  // Power-ups
  powerUps.forEach(p=>{ ctx.fillStyle=p.type==="jumpBoost"?"yellow":"orange"; ctx.fillRect(p.x,p.y,p.w,p.h); });

  // Meta
  ctx.fillStyle=goal.color; ctx.fillRect(goal.x,goal.y,goal.w,goal.h);
}

// --- Loop ---
function gameLoop(){
  update();
  draw();
  requestAnimationFrame(gameLoop);
}

gameLoop();
</script>

</body>
</html>
