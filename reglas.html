<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mini David </title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap');
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{
    font-family:'Montserrat',sans-serif;
    display:flex;
    justify-content:center;
    align-items:center;
    min-height:100vh;
    background: linear-gradient(135deg,#1DB954,#191414);
    color:#fff;
    padding:18px;
  }

  .player-container{
    background: rgba(25,20,20,0.95);
    padding:22px;
    border-radius:18px;
    box-shadow:0 15px 40px rgba(0,0,0,0.45);
    width:100%;
    max-width:520px;
    text-align:center;
    position:relative;
    overflow:hidden;
  }

  .title-container{display:flex;justify-content:center;align-items:center;gap:12px;margin-bottom:12px}
  h1{
    font-size:26px;font-weight:700;
    background: linear-gradient(to right,#1DB954,#1ED760);
    -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  }
  .ghost-emoji{font-size:26px; animation:float 3s ease-in-out infinite}
  @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}

  .heart-btn{
    position:absolute; top:18px; right:18px; background:none; border:none; color:#ff6b6b; font-size:22px; cursor:pointer;
  }

  .album-art{
    width:220px; height:220px; margin:14px auto; border-radius:12px;
    overflow:hidden; box-shadow:0 10px 30px rgba(0,0,0,0.5);
    background:#111; display:flex;align-items:center;justify-content:center;
    transition:transform .28s ease;
  }
  .album-art i{font-size:56px;color:rgba(255,255,255,0.14)}
  .album-art img{width:100%;height:100%;object-fit:cover;display:block;border-radius:12px;transition:transform .3s linear}
  /* rotaci贸n suave mientras reproduce */
  .album-art.playing img{animation:spin 20s linear infinite}
  @keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}

  .song-info{margin-top:12px}
  #song-title{font-size:18px;font-weight:600}
  #song-artist{font-size:14px;color:#b3b3b3;margin-top:4px}

  .progress-container{width:100%;height:8px;background:rgba(255,255,255,0.14);border-radius:10px;margin:18px 0;cursor:pointer;overflow:hidden}
  .progress{height:100%;width:0;background:linear-gradient(to right,#1DB954,#1ED760);border-radius:10px;transition:width .1s linear}

  .time-display{display:flex;justify-content:space-between;font-size:13px;color:#b3b3b3;margin-bottom:6px}

  .main-controls{display:flex;justify-content:center;align-items:center;gap:18px;margin:10px 0}
  .control-btn{background:none;border:none;color:#fff;font-size:18px;cursor:pointer;padding:10px;border-radius:50%;transition:transform .12s ease}
  .control-btn:active{transform:scale(.95)}
  .play-pause{width:62px;height:62px;border-radius:50%;font-size:22px;background:linear-gradient(135deg,#1DB954,#1ED760);box-shadow:0 6px 18px rgba(29,185,84,0.35);display:flex;align-items:center;justify-content:center}

  .secondary-controls{display:flex;justify-content:center;gap:12px;align-items:center;margin:8px 0}
  .volume-container{display:flex;align-items:center;gap:8px}
  .volume-slider{width:110px;-webkit-appearance:none;height:5px;border-radius:6px;background:rgba(255,255,255,0.14);outline:none}
  .volume-slider::-webkit-slider-thumb{-webkit-appearance:none;width:14px;height:14px;border-radius:50%;background:#1DB954;cursor:pointer}

  .playlist-toggle{background:rgba(255,255,255,0.06);border:none;border-radius:30px;padding:10px 14px;color:#fff;margin-top:8px;cursor:pointer;font-weight:600}
  .playlist-toggle:active{transform:scale(.98)}
  .playlist-container{max-height:0;overflow:hidden;transition:max-height .45s ease;text-align:left;margin-top:12px}
  .playlist-container.show{max-height:320px;overflow-y:auto}
  .playlist{list-style:none;padding:8px}
  .playlist li{padding:10px 12px;border-bottom:1px solid rgba(255,255,255,0.04);display:flex;gap:8px;align-items:center;border-radius:8px;margin:6px 0;cursor:pointer}
  .playlist li:hover{background:rgba(255,255,255,0.03)}
  .playlist li.playing{background:rgba(29,185,84,0.12);color:#1ED760;font-weight:600}
  .song-number{width:26px;color:#b3b3b3;font-size:13px}

  .mode-active{color:#1ED760 !important}

  @media (max-width:500px){
    .album-art{width:180px;height:180px}
    h1{font-size:20px}
    .play-pause{width:56px;height:56px}
  }

  /* peque帽o loader mientras carga */
  .loader{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);display:none}
  .loading .loader{display:block}
</style>
</head>
<body>
  <div class="player-container" id="player-container">
    <button class="heart-btn" id="heart-btn" title="Favorito"><i class="far fa-heart"></i></button>

    <div class="title-container">
      <h1>Mini David</h1>
      <div class="ghost-emoji"></div>
    </div>

    <div class="album-art" id="album-art">
      <i class="fas fa-music"></i>
    </div>

    <div class="song-info">
      <div id="song-title">A AP ROCKY LVL</div>
      <div id="song-artist">ASAP Rocky</div>
    </div>

    <div class="progress-container" id="progress-container">
      <div class="progress" id="progress"></div>
    </div>

    <div class="time-display">
      <span id="current-time">0:00</span>
      <span id="duration">0:00</span>
    </div>

    <div class="main-controls">
      <button class="control-btn" id="shuffle" title="Aleatorio"><i class="fas fa-random"></i></button>
      <button class="control-btn" id="prev" title="Anterior"><i class="fas fa-step-backward"></i></button>
      <button class="control-btn play-pause" id="play" title="Reproducir"><i class="fas fa-play"></i></button>
      <button class="control-btn" id="next" title="Siguiente"><i class="fas fa-step-forward"></i></button>
      <button class="control-btn" id="repeat" title="Repetir"><i class="fas fa-redo"></i></button>
    </div>

    <div class="secondary-controls">
      <div class="volume-container">
        <i class="fas fa-volume-up" id="volume-icon"></i>
        <input type="range" id="volume" class="volume-slider" min="0" max="1" step="0.01" value="1">
      </div>
    </div>

    <button class="playlist-toggle" id="playlist-toggle"><i class="fas fa-list"></i> Lista de reproducci贸n</button>
    <div class="playlist-container" id="playlist-container">
      <ul class="playlist" id="playlist"></ul>
    </div>

    <div class="loader" id="loader">Cargando...</div>
    <audio id="player" preload="metadata"></audio>
  </div>

<script>
/* ===== Datos de canciones (usa los tuyos) ===== */
const songs = [
  { title:"A AP ROCKY LVL", artist:"ASAP Rocky", url:"https://raw.githubusercontent.com/poxynext/mp3-host/main/LVL.mp3", image:"https://i.scdn.co/image/ab67616d0000b2737f1e6df8f3fa0c7d39f5d3fb" },
  { title:"Acid Drip", artist:"ASAP Rocky", url:"https://raw.githubusercontent.com/poxynext/mp3-host/main/AcidDrip.mp3", image:"https://i.scdn.co/image/ab67616d0000b273ed3e0bce5d3386e2abef2d55" },
  { title:"Salvatore", artist:"Lana Del Rey", url:"https://raw.githubusercontent.com/poxynext/mp3-host/main/Salvatore.mp3", image:"https://images.genius.com/4e1dfe57a41a23fd6c02cfa899025084.1000x1000x1.png" },
  { title:"GroupieLove", artist:"Lana Del Rey", url:"https://raw.githubusercontent.com/poxynext/mp3-host/main/GroupieLove.mp3", image:"https://i.scdn.co/image/ab67616d0000b273fc318e44b81e5a67fc7db6ea" },
  { title:"Everyday", artist:"ASAP Rocky", url:"https://raw.githubusercontent.com/poxynext/mp3-host/main/Everyday.mp3", image:"https://i.scdn.co/image/ab67616d0000b273f23c1c456d6e8e95d85f1b73" },
  { title:"Doin Time", artist:"Lana Del Rey", url:"https://raw.githubusercontent.com/poxynext/mp3-host/main/Doin_Time.mp3", image:"https://i.scdn.co/image/ab67616d0000b2734a69a4eacb6a3f5af3d8f1cf" },
  { title:"Cinnamon Girl", artist:"Lana Del Rey", url:"https://raw.githubusercontent.com/poxynext/mp3-host/main/CinnamonGirl.mp3", image:"https://i.scdn.co/image/ab67616d0000b273fb0ad72037d399a8ce28b5c6" },
  { title:"BlueJeans", artist:"Lana Del Rey", url:"https://raw.githubusercontent.com/poxynext/mp3-host/main/BlueJeans.mp3", image:"https://i.scdn.co/image/ab67616d0000b273f7d4691c4e5886a28f2d485f" },
  { title:"Tu Boda", artist:"Lana Del Rey", url:"https://raw.githubusercontent.com/poxynext/mp3-host/main/tuboda.mp3", image:"https://i.scdn.co/image/ab67616d0000b273cc12345d8e765abcd123ef90" },
  { title:"Young and Beautiful", artist:"Lana Del Rey", url:"https://raw.githubusercontent.com/poxynext/mp3-host/main/YoungandBeautiful.mp3", image:"https://i.scdn.co/image/ab67616d0000b2735bb0c47721e2a8dfe2a5d7a2" },
  { title:"Ultraviolence", artist:"Lana Del Rey", url:"https://raw.githubusercontent.com/poxynext/mp3-host/main/Ultraviolence.mp3", image:"https://i.scdn.co/image/ab67616d0000b273c719b7e64d0b77e048a3e3c2" }
];

/* ===== Variables de estado ===== */
let current = 0;
let isPlaying = false;
let isShuffle = false;
let repeatMode = 0; // 0: none, 1: repeat all, 2: repeat one
const favoritesKey = 'mini-david-favs-v1';
let favorites = JSON.parse(localStorage.getItem(favoritesKey) || '[]');

/* ===== Elementos DOM ===== */
const player = document.getElementById('player');
const playBtn = document.getElementById('play');
const prevBtn = document.getElementById('prev');
const nextBtn = document.getElementById('next');
const shuffleBtn = document.getElementById('shuffle');
const repeatBtn = document.getElementById('repeat');
const progressContainer = document.getElementById('progress-container');
const progress = document.getElementById('progress');
const titleEl = document.getElementById('song-title');
const artistEl = document.getElementById('song-artist');
const currentTimeEl = document.getElementById('current-time');
const durationEl = document.getElementById('duration');
const volumeSlider = document.getElementById('volume');
const volumeIcon = document.getElementById('volume-icon');
const playlistContainer = document.getElementById('playlist-container');
const playlistToggle = document.getElementById('playlist-toggle');
const playlistEl = document.getElementById('playlist');
const albumArt = document.getElementById('album-art');
const heartBtn = document.getElementById('heart-btn');
const playerContainer = document.getElementById('player-container');
const loader = document.getElementById('loader');

/* ===== Inicializaci贸n de playlist HTML ===== */
function initPlaylist(){
  playlistEl.innerHTML = '';
  songs.forEach((s, i) => {
    const li = document.createElement('li');
    li.dataset.index = i;
    li.innerHTML = `<span class="song-number">${i+1}</span><div style="flex:1">${s.title} - <small style="color:#b3b3b3">${s.artist}</small></div>`;
    li.addEventListener('click', () => {
      current = i; loadSong(current); playSong();
    });
    playlistEl.appendChild(li);
  });
  updatePlaylistUI();
}

/* ===== Actualiza la clase 'playing' de la lista ===== */
function updatePlaylistUI(){
  const items = playlistEl.querySelectorAll('li');
  items.forEach((it, idx) => {
    it.classList.toggle('playing', idx === current);
  });
}

/* ===== Cargar canci贸n (no reproducir autom谩ticamente) ===== */
function loadSong(index){
  const song = songs[index];
  player.src = song.url;
  titleEl.textContent = song.title;
  artistEl.textContent = song.artist;

  // portada: usa <img> para poder animarla (rotar)
  if (song.image){
    albumArt.innerHTML = `<img src="${song.image}" alt="${song.title}">`;
  } else {
    albumArt.innerHTML = '<i class="fas fa-music"></i>';
  }

  // setear estado de favorito
  const isFav = favorites.includes(index);
  heartBtn.innerHTML = isFav ? '<i class="fas fa-heart"></i>' : '<i class="far fa-heart"></i>';

  updatePlaylistUI();
  updateMediaSession(song);

  // mostrar duraci贸n cuando est茅 listo
  // handler globaliza abajo con onloadedmetadata
}

/* ===== Formato mm:ss ===== */
function formatTime(seconds){
  if (isNaN(seconds)) return '0:00';
  const m = Math.floor(seconds/60);
  const s = Math.floor(seconds % 60);
  return `${m}:${s < 10 ? '0' : ''}${s}`;
}

/* ===== Reproducir / Pausar ===== */
function playSong(){
  player.play().catch(()=>{ /* playback may be blocked by browser until user interacts */ });
  isPlaying = true;
  playBtn.innerHTML = '<i class="fas fa-pause"></i>';
  albumArt.classList.add('playing');
  if ('mediaSession' in navigator) navigator.mediaSession.playbackState = 'playing';
}
function pauseSong(){
  player.pause();
  isPlaying = false;
  playBtn.innerHTML = '<i class="fas fa-play"></i>';
  albumArt.classList.remove('playing');
  if ('mediaSession' in navigator) navigator.mediaSession.playbackState = 'paused';
}

/* ===== Siguiente / Anterior / Aleatorio ===== */
function nextSong(){
  if (isShuffle){
    playRandomSong();
  } else {
    current++;
    if (current > songs.length - 1) current = 0;
  }
  loadSong(current);
  playSong();
}
function prevSong(){
  current--;
  if (current < 0) current = songs.length - 1;
  loadSong(current);
  playSong();
}
function playRandomSong(){
  if (songs.length <= 1) return;
  let newIndex;
  do { newIndex = Math.floor(Math.random() * songs.length); } while (newIndex === current && songs.length > 1);
  current = newIndex;
}

/* ===== Media Session API ===== */
function updateMediaSession(song){
  if (!('mediaSession' in navigator)) return;
  navigator.mediaSession.metadata = new MediaMetadata({
    title: song.title,
    artist: song.artist,
    artwork: [
      { src: song.image || '', sizes: '512x512', type: 'image/png' }
    ]
  });

  try {
    navigator.mediaSession.setActionHandler('play', playSong);
    navigator.mediaSession.setActionHandler('pause', pauseSong);
    navigator.mediaSession.setActionHandler('previoustrack', prevSong);
    navigator.mediaSession.setActionHandler('nexttrack', nextSong);
    // opcionales
    navigator.mediaSession.setActionHandler('seekbackward', (details)=>{ player.currentTime = Math.max(0, player.currentTime - (details.seekOffset || 10)); });
    navigator.mediaSession.setActionHandler('seekforward', (details)=>{ player.currentTime = Math.min(player.duration, player.currentTime + (details.seekOffset || 10)); });
    navigator.mediaSession.setActionHandler('stop', pauseSong);
  } catch(e){
    // algunos navegadores no soportan todas las acciones
    // console.log('MediaSession action error', e);
  }
}

/* ===== Progreso ===== */
function updateProgress(){
  const { currentTime, duration } = player;
  if (!duration || isNaN(duration)) return;
  const percent = (currentTime/duration) * 100;
  progress.style.width = `${percent}%`;
  currentTimeEl.textContent = formatTime(currentTime);
}

/* ===== Click en barra para seek ===== */
progressContainer.addEventListener('click', (e) => {
  const rect = progressContainer.getBoundingClientRect();
  const clickX = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
  const width = rect.width;
  if (!player.duration || isNaN(player.duration)) return;
  player.currentTime = (clickX / width) * player.duration;
});

/* ===== Controles f铆sicos ===== */
playBtn.addEventListener('click', ()=> isPlaying ? pauseSong() : playSong());
prevBtn.addEventListener('click', prevSong);
nextBtn.addEventListener('click', nextSong);

/* ===== Shuffle y repeat ===== */
shuffleBtn.addEventListener('click', ()=>{
  isShuffle = !isShuffle;
  shuffleBtn.classList.toggle('mode-active', isShuffle);
  shuffleBtn.title = isShuffle ? 'Aleatorio activado' : 'Aleatorio';
});

repeatBtn.addEventListener('click', ()=>{
  repeatMode = (repeatMode + 1) % 3;
  // 0: none, 1: all, 2: one
  repeatBtn.classList.toggle('mode-active', repeatMode !== 0);
  if (repeatMode === 0) repeatBtn.title = 'Sin repetici贸n';
  else if (repeatMode === 1) repeatBtn.title = 'Repetir toda la lista';
  else repeatBtn.title = 'Repetir una canci贸n';
});

/* ===== Volumen ===== */
volumeSlider.addEventListener('input', ()=>{
  player.volume = volumeSlider.value;
  if (player.volume == 0) volumeIcon.className = 'fas fa-volume-mute';
  else if (player.volume < 0.5) volumeIcon.className = 'fas fa-volume-down';
  else volumeIcon.className = 'fas fa-volume-up';
});

/* ===== Playlist toggle ===== */
playlistToggle.addEventListener('click', ()=>{
  playlistContainer.classList.toggle('show');
  if (playlistContainer.classList.contains('show')) playlistToggle.innerHTML = '<i class="fas fa-chevron-up"></i> Ocultar lista';
  else playlistToggle.innerHTML = '<i class="fas fa-list"></i> Lista de reproducci贸n';
});

/* ===== Favoritos (coraz贸n) ===== */
function saveFavorites(){ localStorage.setItem(favoritesKey, JSON.stringify(favorites)); }
heartBtn.addEventListener('click', ()=>{
  const idx = current;
  const pos = favorites.indexOf(idx);
  if (pos === -1){
    favorites.push(idx);
    heartBtn.innerHTML = '<i class="fas fa-heart"></i>';
  } else {
    favorites.splice(pos,1);
    heartBtn.innerHTML = '<i class="far fa-heart"></i>';
  }
  saveFavorites();
});

/* ===== Eventos del player (solo agregados una vez) ===== */
player.addEventListener('loadedmetadata', ()=>{
  durationEl.textContent = formatTime(player.duration);
});
player.addEventListener('timeupdate', updateProgress);

player.addEventListener('ended', ()=>{
  if (repeatMode === 2){
    // repetir mismo
    player.currentTime = 0;
    playSong();
  } else if (isShuffle){
    playRandomSong();
    loadSong(current);
    playSong();
  } else if (repeatMode === 1){
    current++;
    if (current > songs.length - 1) current = 0;
    loadSong(current);
    playSong();
  } else {
    // sin repetici贸n
    pauseSong();
  }
});

/* ===== Gestos touch (swipe) para m贸viles ===== */
let touchStartX = 0;
let touchEndX = 0;
playerContainer.addEventListener('touchstart', (e)=>{ touchStartX = e.changedTouches[0].screenX; }, {passive:true});
playerContainer.addEventListener('touchend', (e)=>{
  touchEndX = e.changedTouches[0].screenX;
  const diff = touchStartX - touchEndX;
  if (Math.abs(diff) > 50){
    if (diff > 0) { /* swipe left */ nextSong(); }
    else { /* swipe right */ prevSong(); }
  }
}, {passive:true});

/* ===== Inicializaci贸n ===== */
function init(){
  initPlaylist();
  loadSong(current);

  // estado UI inicial
  volumeSlider.value = 1;
  player.volume = 1;
  shuffleBtn.classList.toggle('mode-active', isShuffle);
  repeatBtn.classList.toggle('mode-active', repeatMode !== 0);

  // si hay favs guardadas, actualizar icono del actual
  heartBtn.innerHTML = favorites.includes(current) ? '<i class="fas fa-heart"></i>' : '<i class="far fa-heart"></i>';
}
init();

/* ===== Manejo de clic en playlist (cuando se actualice din谩micamente) ===== */
/* (ya se asign贸 en initPlaylist), pero si quieres actualizar din谩micamente favoritos en la lista,
   puedes a帽adir un icono dentro de cada li al renderizar la lista. */

/* ===== Seguridad: capturar errores de reproducci贸n para no romper la UI ===== */
player.addEventListener('error', (e)=>{
  console.error('Error en reproducci贸n', e);
  // Pausar y mostrar pausa visual
  pauseSong();
});

/* ===== Mejoras opcionales que ya est谩n listas para activar: ===== */
/* - Haptic feedback: navigator.vibrate(10) en eventos de bot贸n (si quieres lo agrego). */
/* - Splash screen: si lo quieres, lo integro. */

</script>
</body>
</html>
